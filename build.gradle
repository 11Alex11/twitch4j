// Apply the java plugin to add support for Java
plugins {
	id 'idea'
	id 'eclipse'
	id "net.ltgt.apt" version "0.15"
	id 'com.jfrog.bintray' version '1.8.0'
	id 'io.ratpack.ratpack-java' version '1.5.4'
	id "io.spring.dependency-management" version "1.0.5.RELEASE"
}

apply from: "version.gradle"
apply from: "testIntegration.gradle"

allprojects {
	apply plugin: "java"
	apply plugin: "net.ltgt.apt"
	apply plugin: "io.spring.dependency-management"

	dependencyManagement {
		imports {
			mavenBom "com.fasterxml.jackson:jackson-bom:$jackson_version"
		}
	}

	repositories {
		jcenter()
		maven { url "https://jitpack.io" }
	}

	// Artifact Info
	group = "com.github.twitch4j"
	description = "This is a api client for the Twitch API V5/IRC/PubSub. (And related services: Streamlabs, ...)"
	version = (System.getenv().containsKey("TRAVIS_TAG")) ? System.getenv("TRAVIS_TAG") : "v0.11.0-SNAPSHOT"

// Doesn't matter, only so that spring doesn't fail
//	mainClassName = 'me.philippheuer.twitch4j.TwitchClient'

	configurations.all {
		// Disable Gradle Caching
		resolutionStrategy.cacheChangingModulesFor 0, 'seconds'
	}
}

subprojects {
	apply from: "${rootDir}/deploy.gradle"
// Dependencies
	dependencies {
		// Logging
		compile "org.slf4j:slf4j-api:$slf4j_version"
		// JSON / YAML
		compile "com.fasterxml.jackson.core:jackson-databind"
		// Project Lombok for annotating processor
		compileOnly "org.projectlombok:lombok:$lombok_version"
		annotationProcessor "org.projectlombok:lombok:$lombok_version"

		// Testing
		testCompile "org.mockito:mockito-core:$mockito_version"
		testCompile "junit:junit:$junit_version"
		compile "ch.qos.logback:logback-classic:$logback_version"
	}
}

wrapper {
	gradleVersion = "4.7" // newer version
	distributionType = Wrapper.DistributionType.ALL
}
